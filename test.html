<div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">googleapiclient</span>
<span class="kn">from</span> <span class="nn">google.oauth2</span> <span class="kn">import</span> <span class="n">service_account</span>
<span class="kn">from</span> <span class="nn">googleapiclient.discovery</span> <span class="kn">import</span> <span class="n">build</span>
<span class="kn">from</span> <span class="nn">pygments</span> <span class="kn">import</span> <span class="n">highlight</span>
<span class="kn">from</span> <span class="nn">pygments.formatters.img</span> <span class="kn">import</span> <span class="n">GifImageFormatter</span><span class="p">,</span> <span class="n">JpgImageFormatter</span>
<span class="kn">from</span> <span class="nn">pygments.lexers</span> <span class="kn">import</span> <span class="n">get_lexer_by_name</span>

<span class="n">SCOPES</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;https://www.googleapis.com/auth/chat.bot&#39;</span><span class="p">]</span>
<span class="n">SERVICE_ACCOUNT_FILE</span> <span class="o">=</span> <span class="s1">&#39;cred.json&#39;</span>

<span class="n">credentials</span> <span class="o">=</span> <span class="n">service_account</span><span class="o">.</span><span class="n">Credentials</span><span class="o">.</span><span class="n">from_service_account_file</span><span class="p">(</span>
    <span class="n">SERVICE_ACCOUNT_FILE</span><span class="p">,</span> <span class="n">scopes</span><span class="o">=</span><span class="n">SCOPES</span><span class="p">)</span>


<span class="k">def</span> <span class="nf">extract</span><span class="p">(</span><span class="n">n</span><span class="p">):</span>
  <span class="k">return</span> <span class="n">n</span><span class="p">[</span><span class="s1">&#39;name&#39;</span><span class="p">]</span>


<span class="n">chat_service</span> <span class="o">=</span> <span class="n">googleapiclient</span><span class="o">.</span><span class="n">discovery</span><span class="o">.</span><span class="n">build</span><span class="p">(</span><span class="s1">&#39;chat&#39;</span><span class="p">,</span> <span class="s1">&#39;v1&#39;</span><span class="p">,</span>
                                               <span class="n">credentials</span><span class="o">=</span><span class="n">credentials</span><span class="p">)</span>
<span class="n">spaces_list</span> <span class="o">=</span> <span class="n">chat_service</span><span class="o">.</span><span class="n">spaces</span><span class="p">()</span><span class="o">.</span><span class="n">list</span><span class="p">()</span><span class="o">.</span><span class="n">execute</span><span class="p">()</span>

<span class="n">all_spaces</span> <span class="o">=</span> <span class="nb">map</span><span class="p">(</span><span class="n">extract</span><span class="p">,</span> <span class="n">spaces_list</span><span class="p">[</span><span class="s1">&#39;spaces&#39;</span><span class="p">])</span>
<span class="n">s</span> <span class="o">=</span> <span class="s2">&quot;&quot;&quot; </span>
<span class="s2">def get_tasks():</span>
<span class="s2">  global words</span>
<span class="s2">  global probs</span>
<span class="s2">  global word_freq_dict</span>
<span class="s2">  global Total</span>

<span class="s2">  for k in word_freq_dict.keys():</span>
<span class="s2">    probs[k] = word_freq_dict[k] / Total</span>
<span class="s2">  cmd = request.form[&#39;cmd&#39;]</span>
<span class="s2">  print(&quot;curcommans&quot;+cmd)</span>
<span class="s2">  similarities = [(Levenshtein.distance(v, cmd)) for v in</span>
<span class="s2">                  word_freq_dict.keys()]</span>
<span class="s2">  df = pd.DataFrame.from_dict(probs, orient=&#39;index&#39;).reset_index()</span>
<span class="s2">  df = df.rename(columns={ 0: &#39;Prob&#39;})</span>
<span class="s2">  df[&#39;Similarity&#39;] = similarities</span>
<span class="s2">  df[&#39;cmd&#39;] =  word_freq_dict.keys()</span>
<span class="s2">  output = df.sort_values([&#39;Similarity&#39;], ascending=True)</span>

<span class="s2">&quot;&quot;&quot;</span>
<span class="n">lexer</span> <span class="o">=</span> <span class="n">get_lexer_by_name</span><span class="p">(</span><span class="s2">&quot;python&quot;</span><span class="p">)</span>
<span class="n">formatter</span> <span class="o">=</span> <span class="n">JpgImageFormatter</span><span class="p">()</span>


<span class="n">result</span> <span class="o">=</span> <span class="n">highlight</span><span class="p">(</span><span class="n">s</span><span class="p">,</span> <span class="n">lexer</span><span class="p">,</span> <span class="n">formatter</span><span class="p">)</span>


<span class="n">response</span> <span class="o">=</span> <span class="n">chat_service</span><span class="o">.</span><span class="n">spaces</span><span class="p">()</span><span class="o">.</span><span class="n">messages</span><span class="p">()</span><span class="o">.</span><span class="n">create</span><span class="p">(</span>
    <span class="n">parent</span><span class="o">=</span><span class="n">spaces_list</span><span class="p">[</span><span class="s1">&#39;spaces&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">][</span><span class="s1">&#39;name&#39;</span><span class="p">],</span>
    <span class="n">body</span><span class="o">=</span><span class="p">{</span>
      <span class="s2">&quot;cards&quot;</span><span class="p">:</span> <span class="p">[</span>
        <span class="p">{</span>
          <span class="s2">&quot;header&quot;</span><span class="p">:</span> <span class="p">{</span>
            <span class="s2">&quot;title&quot;</span><span class="p">:</span> <span class="s2">&quot;ChatBot&quot;</span><span class="p">,</span>
            <span class="s2">&quot;imageUrl&quot;</span><span class="p">:</span> <span class="s2">&quot;https://www.gstatic.com/images/icons/material/system/1x/face_black_24dp.png&quot;</span><span class="p">,</span>

          <span class="p">},</span>
          <span class="s2">&quot;sections&quot;</span><span class="p">:</span> <span class="p">[</span>
            <span class="p">{</span>
              <span class="s2">&quot;widgets&quot;</span><span class="p">:</span> <span class="p">[</span>
                <span class="p">{</span>
                  <span class="s2">&quot;textParagraph&quot;</span><span class="p">:</span> <span class="p">{</span>
                    <span class="s2">&quot;text&quot;</span><span class="p">:</span> <span class="n">result</span>
                  <span class="p">}</span>
                <span class="p">}</span>

              <span class="p">]</span>
            <span class="p">}</span>
          <span class="p">]</span>
        <span class="p">}</span>
      <span class="p">]</span>
    <span class="p">})</span><span class="o">.</span><span class="n">execute</span><span class="p">()</span>
<span class="nb">print</span><span class="p">(</span><span class="n">response</span><span class="p">)</span>
</pre></div>
